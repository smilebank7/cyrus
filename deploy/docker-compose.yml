networks:
  traefik-public:
    external: true

services:
  cyrus:
    image: ghcr.io/smilebank7/cyrus:latest
    container_name: cyrus
    restart: unless-stopped
    command: ["cyrus", "start"]
    env_file:
      - .env
    volumes:
      - cyrus-data:/root/.cyrus
      - cyrus-repos:/root/.cyrus/repos
      - opencode-data:/root/.local/share/opencode
    networks:
      - traefik-public
    labels:
      - traefik.enable=true
      - "traefik.http.routers.cyrus.rule=Host(`${CYRUS_DOMAIN:-cyrus.example.com}`)"
      - traefik.http.routers.cyrus.entrypoints=websecure
      - traefik.http.routers.cyrus.tls.certresolver=myresolver
      - traefik.http.services.cyrus.loadbalancer.server.port=3456
      - "traefik.http.routers.cyrus-http.rule=Host(`${CYRUS_DOMAIN:-cyrus.example.com}`)"
      - traefik.http.routers.cyrus-http.entrypoints=web
      - traefik.http.middlewares.cyrus-redirect.redirectscheme.scheme=https
      - traefik.http.routers.cyrus-http.middlewares=cyrus-redirect

volumes:
  cyrus-data:
  cyrus-repos:
  opencode-data:
